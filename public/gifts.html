<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мои подарки | PrizeGift</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f6f8fb; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 32px auto; background: #fff; border-radius: 18px; box-shadow: 0 6px 36px #d7e3fa90; padding: 24px; }
        h2 { text-align: center; }
        .gift-list { display: flex; flex-wrap: wrap; gap: 18px; justify-content: center; }
        .gift { width: 120px; border-radius: 14px; background: #f9fafd; padding: 10px; box-shadow: 0 2px 8px #c7d8f950; text-align: center; position: relative; }
        .gift img { max-width: 80px; max-height: 80px; margin-bottom: 6px; }
        .badge { position: absolute; top: 9px; right: 8px; font-size: 12px; padding: 2px 8px; border-radius: 8px; }
        .common  { background: #e7e7e7; color: #3b3b3b; }
        .rare    { background: #91caff; color: #165b94; }
        .epic    { background: #b18cff; color: #37227b; }
        .source { font-size: 12px; color: #888; margin-bottom: 3px;}
        .status { font-size: 12px; margin-top: 5px; }
        .claimed { color: #31c731; }
        .waiting { color: #e09815; }
    </style>
</head>
<body>
<div class="container">
    <h2>Мои подарки</h2>
    <div id="giftList" class="gift-list">Загрузка...</div>
</div>
<script>
const API_URL = "https://prizegift.space/inventory/";

let userId = null;

// 1. Получить user_id из Telegram WebApp
function getUserId() {
    if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
        return Telegram.WebApp.initDataUnsafe.user.id;
    }
    // Fallback для отладки — можно временно вписать свой user_id
    return prompt("Введите свой user_id Telegram:");
}

// 2. Подгружаем подарки
async function loadGifts() {
    userId = getUserId();
    if (!userId) {
        document.getElementById('giftList').innerHTML = "user_id не найден!";
        return;
    }
    try {
        let res = await fetch(API_URL + userId);
        let data = await res.json();
        if (!data.gifts || !data.gifts.length) {
            document.getElementById('giftList').innerHTML = "<div>У вас пока нет подарков...</div>";
            return;
        }
        let html = '';
        for (let g of data.gifts) {
            let badgeClass = g.category === "epic" ? "badge epic" : g.category === "rare" ? "badge rare" : "badge common";
            let status = g.claimed ? "<span class='status claimed'>Получен</span>" :
                         g.needs_send ? "<span class='status waiting'>Ожидает отправки</span>" : "<span class='status'>В наличии</span>";

            // Показываем картинку через file_id (как preview Telegram gifts) — нужно доработать!
            // Пока просто плейсхолдер, но если у тебя есть url к картинке — подставь вместо ссылки ниже.
            let imgUrl = `https://telegram-wheel-prize.vercel.app/images/gifts/${g.file_id}.webp`;
            // Или если нет изображений — используем emoji как картинку (или статику)
            if (!g.file_id) imgUrl = "https://telegram.org/img/t_logo.png";

            html += `<div class="gift">
                <span class="${badgeClass}">${g.category.toUpperCase()}</span>
                <div class="source">${g.source}</div>
                <img src="${imgUrl}" alt="${g.title}" loading="lazy" onerror="this.src='https://telegram.org/img/t_logo.png'">
                <div>${g.title}</div>
                ${status}
            </div>`;
        }
        document.getElementById('giftList').innerHTML = html;
    } catch(e) {
        document.getElementById('giftList').innerHTML = "Ошибка загрузки: " + e;
    }
}

window.onload = loadGifts;
</script>
</body>
</html>
