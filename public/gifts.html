<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å ‚Äî PrizeGift</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f6f8fb; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 24px auto 80px auto; background: #fff; border-radius: 18px; box-shadow: 0 6px 36px #d7e3fa90; padding: 18px; }
        h2 { text-align: center; }
        .gift-list { display: flex; flex-wrap: wrap; gap: 18px; justify-content: center; margin-top: 18px; }
        .gift { width: 120px; border-radius: 14px; background: #f9fafd; padding: 10px; box-shadow: 0 2px 8px #c7d8f950; text-align: center; position: relative; transition: 0.2s; }
        .gift:hover { box-shadow: 0 4px 14px #c7d8f9dd; transform: translateY(-2px) scale(1.03);}
        .badge { position: absolute; top: 10px; right: 10px; font-size: 12px; padding: 2px 8px; border-radius: 8px; }
        .common  { background: #e7e7e7; color: #3b3b3b; }
        .rare    { background: #91caff; color: #165b94; }
        .epic    { background: #b18cff; color: #37227b; }
        .source { font-size: 12px; color: #888; margin-bottom: 3px;}
        .status { font-size: 12px; margin-top: 5px; }
        .claimed { color: #31c731; }
        .waiting { color: #e09815; }
        .gift-title { font-size: 28px; margin-bottom: 4px; }
        .date { color: #a6a6a6; font-size: 11px; }
        @media (max-width: 500px) {
            .container { padding: 5px; }
            .gift { width: 47vw; min-width: 90px;}
        }
        /* ======= Bottom Menu ======= */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0; right: 0;
            height: 64px;
            background: #fff;
            box-shadow: 0 -2px 12px #c7d8f950;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            z-index: 100;
        }
        .menu-btn {
            flex: 1;
            text-align: center;
            color: #555;
            font-size: 15px;
            text-decoration: none;
            padding: 7px 0 0 0;
            transition: color 0.13s;
        }
        .menu-btn span { font-size: 22px; }
        .menu-btn.active, .menu-btn:active {
            color: #2077fa;
            font-weight: 700;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>–ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
    <div id="giftList" class="gift-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<!-- ==== –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é ==== -->
<nav class="bottom-menu">
    <a href="/roulette.html" class="menu-btn">
        <span>üé∞</span><br>
        –†—É–ª–µ—Ç–∫–∞
    </a>
    <a href="/gifts.html" class="menu-btn">
        <span>üéÅ</span><br>
        –ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
    </a>
</nav>
<script>
// –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é:
document.querySelectorAll('.menu-btn').forEach(btn => {
    if(window.location.pathname.endsWith(btn.getAttribute('href'))) {
        btn.classList.add('active');
    }
});
</script>
<script>
const API_URL = "https://prizegift.space/inventory/";

// 1. –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ Telegram WebApp (–≤ Telegram), –ª–∏–±–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—Ä—É—á–Ω—É—é (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)
function getUserId() {
    if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
        return Telegram.WebApp.initDataUnsafe.user.id;
    }
    // –î–ª—è —Ç–µ—Å—Ç–∞ –≤–Ω–µ Telegram WebApp ‚Äî —Å–ø—Ä–æ—Å–∏–º –≤—Ä—É—á–Ω—É—é
    return prompt("–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π user_id Telegram:");
}

async function loadGifts() {
    const userId = getUserId();
    if (!userId) {
        document.getElementById('giftList').innerHTML = "user_id –Ω–µ –Ω–∞–π–¥–µ–Ω!";
        return;
    }
    try {
        const res = await fetch(API_URL + userId);
        const data = await res.json();
        if (!data.gifts || !data.gifts.length) {
            document.getElementById('giftList').innerHTML = "<div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤...</div>";
            return;
        }
        let html = '';
        for (let g of data.gifts) {
            let badgeClass = g.category === "epic" ? "badge epic" : g.category === "rare" ? "badge rare" : "badge common";
            let status = g.claimed ? "<span class='status claimed'>–ü–æ–ª—É—á–µ–Ω</span>" :
                         g.needs_send ? "<span class='status waiting'>–û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏</span>" : "<span class='status'>–í –Ω–∞–ª–∏—á–∏–∏</span>";

            // –ü–æ–∫–∞–∑–∞—Ç—å emoji/–Ω–∞–∑–≤–∞–Ω–∏–µ ‚Äî title
            let displayTitle = (g.title && g.title.length <= 3) ? `<div class="gift-title">${g.title}</div>` : `<div style="font-size:16px; margin-bottom:2px">${g.title || "–ü–æ–¥–∞—Ä–æ–∫"}</div>`;

            html += `<div class="gift">
                <span class="${badgeClass}">${g.category.toUpperCase()}</span>
                <div class="source">${g.source}</div>
                ${displayTitle}
                <div class="date">${g.received_at ? g.received_at.split(" ")[0] : ""}</div>
                ${status}
            </div>`;
        }
        document.getElementById('giftList').innerHTML = html;
    } catch(e) {
        document.getElementById('giftList').innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + e;
    }
}

window.onload = loadGifts;
</script>
</body>
</html>
